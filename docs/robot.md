# Mathematical Description of the Omnidirectional Robot

Based on the physical specifications provided, here is the corrected mathematical description of the omnidirectional robot.

## 1. Physical Parameters

We define the constants for the system based on the robot's geometry and mass.

| Parameter | Symbol | Value | Description |
| :--- | :---: | :---: | :--- |
| **Robot Radius** | $R$ | $0.09 \text{ m}$ | Half of the 18 cm diameter. |
| **Wheel Radius** | $r$ | $0.03 \text{ m}$ | Radius of the driving wheels. |
| **Robot Mass** | $m$ | $2.5 \text{ kg}$ | Total mass of the robot. |
| **Moment of Inertia** | $I_z$ | $\approx 0.0101 \text{ kg}\cdot\text{m}^2$ | Approximated as a solid cylinder ($I_z = \frac{1}{2}mR^2$). |
| **Wheel Angles** | $\alpha_i$ | $[60^\circ, 130^\circ, 230^\circ, 300^\circ]$ | Angular position of each wheel in the local frame. |

## 2. Command Kinematics (Controller Geometry)

This section describes how the robot's controller calculates the required wheel angular velocities from the commanded target velocities in the local frame. This is a purely geometric transformation and does not account for physical limitations or dynamics.

Let the commanded local velocity vector be $\mathbf{v}_{cmd} = [v_{x,cmd}, v_{y,cmd}, \omega_{cmd}]^T$ and the vector of commanded wheel angular velocities be $\boldsymbol{\dot{\varphi}}_{cmd} = [\dot{\varphi}_{1,cmd}, \dot{\varphi}_{2,cmd}, \dot{\varphi}_{3,cmd}, \dot{\varphi}_{4,cmd}]^T$.

The relationship is defined by the inverse kinematics matrix $J_{inverse}$:

$$
\boldsymbol{\dot{\varphi}}_{cmd} = J_{inverse} \mathbf{v}_{cmd}
$$

The speed of wheel $i$ is related to the body velocity by projecting the commanded velocity vector onto the wheel's drive direction:
$$
v_{wheel,i,cmd} = r \cdot \dot{\varphi}_{i,cmd} = -\sin(\alpha_i) v_{x,cmd} + \cos(\alpha_i) v_{y,cmd} + R \cdot \omega_{cmd}
$$

Expanding this into matrix form:

$$
\begin{bmatrix} \dot{\varphi}_{1,cmd} \\ \dot{\varphi}_{2,cmd} \\ \dot{\varphi}_{3,cmd} \\ \dot{\varphi}_{4,cmd} \end{bmatrix} = \frac{1}{r} \underbrace{\begin{bmatrix} -\sin(60^\circ) & \cos(60^\circ) & R \\ -\sin(130^\circ) & \cos(130^\circ) & R \\ -\sin(230^\circ) & \cos(230^\circ) & R \\ -\sin(300^\circ) & \cos(300^\circ) & R \end{bmatrix}}_{J_{inverse}} \begin{bmatrix} v_{x,cmd} \\ v_{y,cmd} \\ \omega_{cmd} \end{bmatrix}
$$

**Note on Unknown Dynamics:** How the actual wheel velocities $\boldsymbol{\dot{\varphi}}$ reach these commanded velocities $\boldsymbol{\dot{\varphi}}_{cmd}$ is determined by the unknown motor dynamics and controller response (e.g., PID loops, motor time constants, voltage limits).

## 3. Dynamic Model (Equations of Motion)

The dynamic model describes the physical evolution of the robot's actual state due to applied forces and torques. Since the Center of Mass (CoM) is unknown, we introduce offset variables $(x_{cm}, y_{cm})$ from the geometric center.

* **Actual Local Velocity Vector:** $\mathbf{v} = [v_x, v_y, \omega]^T$
* **Motor Torque Vector:** $\boldsymbol{\tau} = [\tau_1, \tau_2, \tau_3, \tau_4]^T$

The Equations of Motion in the **Local Frame** are:
$$\mathbf{F}_{inertial} + \mathbf{F}_{coriolis} = \mathbf{F}_{propulsion} - \mathbf{F}_{friction}$$
or
$$
\mathbf{M} \dot{\mathbf{v}} + \mathbf{C}(\mathbf{v})\mathbf{v} = \mathbf{B} \boldsymbol{\tau} - \mathbf{F}_{friction}
$$

**A. Mass Matrix ($\mathbf{M}$):**
Captures inertia. The unknown CoM offset $(x_{cm}, y_{cm})$ introduces coupling between linear and angular motion.
$$
\mathbf{M} = \begin{bmatrix} m & 0 & -m y_{cm} \\ 0 & m & m x_{cm} \\ -m y_{cm} & m x_{cm} & I_z \end{bmatrix}
$$

**B. Coriolis & Centripetal Matrix ($\mathbf{C}(\mathbf{v})$):**
Describes the fictitious forces arising from the rotating reference frame, also dependent on the unknown CoM.
$$
\mathbf{C}(\mathbf{v}) = \begin{bmatrix} 0 & -m \omega & -m \omega x_{cm} \\ m \omega & 0 & -m \omega y_{cm} \\ m \omega x_{cm} & m \omega y_{cm} & 0 \end{bmatrix}
$$

**C. Input Matrix ($\mathbf{B}$):**
Maps the torques applied by the motors to generalized forces on the robot body. It is related to the transpose of the inverse kinematics matrix.
$$
\mathbf{B} = \frac{1}{r} J_{inverse}^T
$$

**Connection between Kinematics and Dynamics:**
The motor torques $\boldsymbol{\tau}$ in the dynamic equation are generated by the robot's low-level motor controllers attempting to minimize the error between the commanded wheel speeds from Section 2 ($\boldsymbol{\dot{\varphi}}_{cmd}$) and the actual wheel speeds ($\boldsymbol{\dot{\varphi}}$). This relationship, $\boldsymbol{\tau} = f(\boldsymbol{\dot{\varphi}}_{cmd}, \boldsymbol{\dot{\varphi}})$, constitutes the unknown actuator dynamics.